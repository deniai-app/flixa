import { useCallback } from 'react';
import { vscode } from '../vscode';
import type { ImageAttachment } from '../types';

export interface UseVSCodeReturn {
	sendMessage: (text: string, images?: ImageAttachment[]) => void;
	toggleAgentMode: (enabled: boolean) => void;
	setApprovalMode: (mode: string) => void;
	setModel: (model: string) => void;
	switchChat: (sessionId: string) => void;
	newChat: () => void;
	deleteChat: (sessionId: string) => void;
	stopAgent: () => void;
	ready: () => void;
	showUsageDetail: () => void;
	login: () => void;
	openBilling: () => void;
}

export function useVSCode(): UseVSCodeReturn {
	const sendMessage = useCallback((text: string, images?: ImageAttachment[]) => {
		vscode.postMessage({ type: 'sendMessage', message: text, images });
	}, []);

	const toggleAgentMode = useCallback((enabled: boolean) => {
		vscode.postMessage({ type: 'toggleAgentMode', enabled });
	}, []);

	const setApprovalMode = useCallback((mode: string) => {
		vscode.postMessage({ type: 'setApprovalMode', mode });
	}, []);

	const setModel = useCallback((model: string) => {
		vscode.postMessage({ type: 'setModel', model });
	}, []);

	const switchChat = useCallback((sessionId: string) => {
		vscode.postMessage({ type: 'switchChat', sessionId });
	}, []);

	const newChat = useCallback(() => {
		vscode.postMessage({ type: 'newChat' });
	}, []);

	const deleteChat = useCallback((sessionId: string) => {
		vscode.postMessage({ type: 'deleteChat', sessionId });
	}, []);

	const stopAgent = useCallback(() => {
		vscode.postMessage({ type: 'stopAgent' });
	}, []);

	const ready = useCallback(() => {
		vscode.postMessage({ type: 'ready' });
	}, []);

	const showUsageDetail = useCallback(() => {
		vscode.postMessage({ type: 'showUsageDetail' });
	}, []);

	const login = useCallback(() => {
		vscode.postMessage({ type: 'login' });
	}, []);

	const openBilling = useCallback(() => {
		vscode.postMessage({ type: 'openBilling' });
	}, []);

	return {
		sendMessage,
		toggleAgentMode,
		setApprovalMode,
		setModel,
		switchChat,
		newChat,
		deleteChat,
		stopAgent,
		ready,
		showUsageDetail,
		login,
		openBilling,
	};
}
